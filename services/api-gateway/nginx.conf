events {
    worker_connections 1024;
}

http {
    upstream auth_service {
        server auth-service:3000;
    }

    upstream config_service {
        server config-service:3000;
    }

    upstream appointment_service {
        server appointment-service:3000;
    }

    upstream queue_service {
        server queue-service:3000;
    }

    upstream notification_service {
        server notification-service:3000;
    }

    upstream statistics_service {
        server statistics-service:3000;
    }

    server {
        listen 80;
        server_name localhost;

        # Configuraci√≥n de CORS
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type' always;

        # Health check
        location /health {
            return 200 '{"status":"ok","service":"api-gateway"}';
            add_header Content-Type application/json;
        }

        # Auth Service
        location /api/auth/ {
            proxy_pass http://auth_service/api/auth/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Config Service
        location /api/config/ {
            proxy_pass http://config_service/api/config/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Appointment Service
        location /api/appointments/ {
            proxy_pass http://appointment_service/api/appointments/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Queue Service
        location /api/queue/ {
            proxy_pass http://queue_service/api/queue/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Notification Service
        location /api/notifications/ {
            proxy_pass http://notification_service/api/notifications/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Statistics Service
        location /api/statistics/ {
            proxy_pass http://statistics_service/api/statistics/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }
}