events {
    worker_connections 1024;
}

http {
    # Upstreams para los servicios de backend
    upstream auth_service {
        server auth-service:3001;
        server auth-service-2:3001;
    }
    upstream config_service {
        server config-service:3002;
        server config-service-2:3002;
    }
    upstream appointment_upstream {
        server appointment-service:3000;
        server appointment-service-2:3003;
    }
    upstream queue_service {
        server queue-service:3004;
        server queue-service-2:3004;
    }
    upstream notification_service {
        server notification-service:3005;
        server notification-service-2:3005;
    }
    upstream statistics_service {
        server statistics-service:3006;
        server statistics-service-2:3006;
    }
    upstream ai_service {
        server ai-service:3007;
    }

    # Upstreams para los servicios de frontend
    upstream auth_frontend {
        server auth-frontend:80;
    }
    upstream lobby_frontend {
        server lobby-frontend:80;
    }
    upstream config_frontend {
        server config-frontend:80;
    }

    upstream admin_frontend {
        server admin-frontend:80;
    }

    upstream totem_frontend {
        server totem-frontend:80;
    }
    upstream appointment_frontend {
        server appointment-service:3000;
    }

    server {
        listen 80;
        server_name localhost;

        # ============================================
        # API Endpoints
        # ============================================

        location /api/auth/ {
            proxy_pass http://auth_service/api/auth/;
        }

        location /api/config/ {
            proxy_pass http://config_service/api/config/;
        }

        location /api/appointments/ {
            proxy_pass http://appointment_upstream/api/appointments/;
        }

        location /api/queue/ {
            proxy_pass http://queue_service/api/queue/;
        }

        location /api/notifications/ {
            proxy_pass http://notification_service/api/notifications/;
        }

        location /api/statistics/ {
            proxy_pass http://statistics_service/api/statistics/;
        }

        location /api/ai/ {
            proxy_pass http://ai_service/api/ai/;
        }

        # ============================================
        # Frontend Endpoints
        # ============================================

        location /auth/ {
            proxy_pass http://auth_frontend/;
        }

        location /config/ {
            proxy_pass http://config_frontend/;
        }

        location /admin/ {
            proxy_pass http://admin_frontend/;
        }

        location /totem/ {
            proxy_pass http://totem_frontend/;
        }

        location /appointment/ {
            proxy_pass http://appointment_frontend/;
        }

        location / {
            proxy_pass http://lobby_frontend/;
        }
    }
}